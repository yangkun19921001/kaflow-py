# =================================================================
# KaFlow-Py 多Agent深度研究模版
# 基于 KaFlow-Py 协议标准的多Agent协作研究配置
# =================================================================

# =================================================================
# 协议版本与元信息
# =================================================================
protocol:
  name: "KaFlow-Py Multi-Agent Deep Research Template"
  version: "1.0.0"
  schema_version: "2025.09.10"
  description: "基于 KaFlow-Py 的多Agent深度研究模版"
  author: "DevYK"
  license: "MIT"

# =================================================================
# 全局配置
# =================================================================
global_config:
  runtime:
    timeout: 900  # 15分钟
    max_retries: 3
    parallel_limit: 1  # 线性执行
    debug_mode: false
    trace_enabled: true
    checkpoint_enabled: true

  logging:
    level: "INFO"
    format: "json"
    output: "file"
    file_path: "./logs/multi_agent_research.log"
    max_size: "100MB"
    max_files: 5

  memory:
    enabled: true
    provider: "sqlite"
    ttl: 7200  # 2小时
    max_size: "200MB"
    connection:
      host: "localhost"
      database: "research_memory.db"

# =================================================================
# LLM 配置
# =================================================================
llm_config:
  base_url: "https://api.openai.com/v1"
  api_key: "${OPENAI_API_KEY}"
  model: "gpt-4o-mini"
  temperature: 0.3
  max_tokens: 4096
  timeout: 60

# =================================================================
# 工作流配置
# =================================================================
workflow:
  name: "简化多Agent研究工作流"
  version: "1.0.0"
  description: "线性多Agent协作进行研究：规划 → 搜集 → 分析 → 报告"
  author: "DevYK"
  schema_version: "2025.09.10"
  
  settings:
    timeout: 900
    max_retries: 3
    debug_mode: false

  # =================================================================
  # 节点定义
  # =================================================================
  nodes:
    - name: "start_node"
      type: "start"
      description: "研究工作流开始节点"
      position:
        x: 100
        y: 200
      outputs:
        - name: "research_topic"
          type: "string"
          description: "研究主题"
        - name: "research_requirements"
          type: "object"
          description: "研究要求和参数"

    - name: "research_planner"
      type: "agent"
      description: "研究规划Agent - 制定研究计划和策略"
      agent_ref: "research_planner"
      position:
        x: 300
        y: 200
      
      inputs:
        - name: "topic"
          type: "string"
          required: true
          source: "start_node.research_topic"
        - name: "requirements"
          type: "object"
          required: false
          source: "start_node.research_requirements"
      
      outputs:
        - name: "research_plan"
          type: "object"
          description: "详细研究计划"
        - name: "search_strategy"
          type: "object"
          description: "信息搜集策略"

    - name: "info_collector"
      type: "agent"
      description: "信息收集Agent - 综合信息搜集"
      agent_ref: "info_collector"
      position:
        x: 500
        y: 200
      
      inputs:
        - name: "research_plan"
          type: "object"
          required: true
          source: "research_planner.research_plan"
        - name: "search_strategy"
          type: "object"
          required: true
          source: "research_planner.search_strategy"
      
      outputs:
        - name: "collected_data"
          type: "object"
          description: "收集到的研究数据"
        - name: "data_summary"
          type: "string"
          description: "数据收集摘要"

    - name: "data_analyst"
      type: "agent"
      description: "数据分析Agent - 深度分析收集的信息"
      agent_ref: "data_analyst"
      position:
        x: 700
        y: 200
      
      inputs:
        - name: "research_plan"
          type: "object"
          required: true
          source: "research_planner.research_plan"
        - name: "collected_data"
          type: "object"
          required: true
          source: "info_collector.collected_data"
      
      outputs:
        - name: "analysis_results"
          type: "object"
          description: "分析结果"
        - name: "key_insights"
          type: "array"
          description: "关键洞察"
        - name: "recommendations"
          type: "array"
          description: "建议列表"

    - name: "report_writer"
      type: "agent"
      description: "报告撰写Agent - 生成最终研究报告"
      agent_ref: "report_writer"
      position:
        x: 900
        y: 200
      
      inputs:
        - name: "research_plan"
          type: "object"
          required: true
          source: "research_planner.research_plan"
        - name: "collected_data"
          type: "object"
          required: true
          source: "info_collector.collected_data"
        - name: "analysis_results"
          type: "object"
          required: true
          source: "data_analyst.analysis_results"
        - name: "key_insights"
          type: "array"
          required: true
          source: "data_analyst.key_insights"
        - name: "recommendations"
          type: "array"
          required: true
          source: "data_analyst.recommendations"
      
      outputs:
        - name: "final_report"
          type: "object"
          description: "最终研究报告"
        - name: "executive_summary"
          type: "string"
          description: "执行摘要"

    - name: "end_node"
      type: "end"
      description: "研究工作流结束节点"
      position:
        x: 1100
        y: 200
      inputs:
        - name: "research_output"
          type: "object"
          required: true
          source: "report_writer.final_report"
          description: "最终研究输出"

  # =================================================================
  # 边定义 (连接关系)
  # =================================================================
  edges:
    - from: "start_node"
      to: "research_planner"
      description: "传递研究主题到规划Agent"
      
    - from: "research_planner"
      to: "info_collector"
      description: "传递研究计划到信息收集Agent"
      
    - from: "info_collector"
      to: "data_analyst"
      description: "传递收集数据到分析Agent"
      
    - from: "data_analyst"
      to: "report_writer"
      description: "传递分析结果到报告Agent"
      
    - from: "report_writer"
      to: "end_node"
      description: "输出最终研究报告"

# =================================================================
# Agent 配置
# =================================================================
agents:
  research_planner:
    name: "research_planner"
    type: "agent"
    description: "研究规划专家Agent"
    enabled: true
    
    system_prompt: |
      你是一个专业的研究规划专家。你的任务是：
      1. 分析研究主题的复杂性和范围
      2. 制定详细的研究计划和策略
      3. 确定需要收集的信息类型和来源
      4. 设计研究方法和分析框架
      5. 制定信息搜集的优先级和策略
      
      请基于用户提供的研究主题，制定一个结构化的研究计划。
    
    llm:
      base_url: "https://api.openai.com/v1"
      api_key: "${OPENAI_API_KEY}"
      model: "gpt-4o-mini"
      temperature: 0.3
      max_tokens: 4096
      timeout: 60
    
  info_collector:
    name: "info_collector"
    type: "agent"
    description: "综合信息收集Agent"
    enabled: true
    
    system_prompt: |
      你是一个专业的信息收集专家。你的任务是：
      1. 根据研究计划搜索和收集相关信息
      2. 从多个来源获取高质量数据（学术、行业、新闻等）
      3. 评估信息的可靠性和相关性
      4. 整理和结构化收集到的信息
      5. 提供数据收集的摘要和质量评估
      
      请专注于收集准确、全面、有价值的信息。
    
    llm:
      base_url: "https://api.openai.com/v1"
      api_key: "${OPENAI_API_KEY}"
      model: "gpt-4o-mini"
      temperature: 0.2
      max_tokens: 4096
      timeout: 60
      
    tools:
      - name: "web_search"
        type: "api"
        description: "网络搜索工具"
      - name: "academic_search"
        type: "api"
        description: "学术搜索工具"
    
  data_analyst:
    name: "data_analyst"
    type: "agent"
    description: "数据分析专家Agent"
    enabled: true
    
    system_prompt: |
      你是一个专业的数据分析专家。你的任务是：
      1. 深度分析和解释收集到的数据
      2. 识别关键模式、趋势和洞察
      3. 进行定量和定性分析
      4. 提供基于数据的结论和建议
      5. 评估数据的可信度和局限性
      
      请使用科学的分析方法，提供客观、准确的分析结果。
    
    llm:
      base_url: "https://api.openai.com/v1"
      api_key: "${OPENAI_API_KEY}"
      model: "gpt-4o-mini"
      temperature: 0.1
      max_tokens: 4096
      timeout: 60
      
    tools:
      - name: "statistical_analysis"
        type: "function"
        description: "统计分析工具"
    
  report_writer:
    name: "report_writer"
    type: "agent"
    description: "报告撰写专家Agent"
    enabled: true
    
    system_prompt: |
      你是一个专业的研究报告撰写专家。你的任务是：
      1. 整合所有研究成果和分析结果
      2. 撰写结构清晰、逻辑严密的研究报告
      3. 确保报告的专业性和可读性
      4. 提供执行摘要和关键建议
      5. 包含适当的结论和后续建议
      
      请撰写一份高质量的专业研究报告。
    
    llm:
      base_url: "https://api.openai.com/v1"
      api_key: "${OPENAI_API_KEY}"
      model: "gpt-4o-mini"
      temperature: 0.4
      max_tokens: 6144
      timeout: 90

# =================================================================
# 记忆配置
# =================================================================
memory:
  enabled: true
  provider: "sqlite"
  ttl: 7200
  max_size: "200MB"
  connection:
    database: "research_memory.db"
  
  memory_types:
    workflow_state:
      enabled: true
      ttl: 7200
      checkpoint_interval: 300
    
    agent_context:
      enabled: true
      ttl: 3600
      max_context_size: 8192

# =================================================================
# 工具配置
# =================================================================
tools:
  - name: "web_search"
    type: "api"
    description: "网络搜索工具"
    config:
      api_key: "${SEARCH_API_KEY}"
      max_results: 10
      
  - name: "academic_search"
    type: "api"
    description: "学术搜索工具"
    config:
      api_key: "${ACADEMIC_API_KEY}"
      databases: ["arxiv", "scholar"]
      
  - name: "statistical_analysis"
    type: "function"
    description: "统计分析工具"

# =================================================================
# 使用说明
# =================================================================
usage_notes: |
  简化多Agent深度研究模版使用说明：
  
  1. 功能特点：
     - 4个专业Agent线性协作
     - 简单清晰的工作流程
     - 完整的研究流程覆盖
     - 易于理解和定制
  
  2. 工作流程：
     用户输入 → 研究规划 → 信息搜集 → 深度分析 → 报告生成
  
  3. 环境变量：
     - OPENAI_API_KEY: OpenAI API密钥
     - SEARCH_API_KEY: 搜索API密钥（可选）
     - ACADEMIC_API_KEY: 学术搜索API密钥（可选）
  
  4. 启动方式：
     python main.py --config config/multi_agent.yaml
  
  5. 自定义配置：
     - 修改各Agent的system_prompt定制专业能力
     - 调整LLM参数控制输出质量
     - 配置不同的工具和API
     - 修改记忆存储配置
  
  6. 适用场景：
     - 市场研究分析
     - 技术调研报告
     - 行业趋势分析
     - 学术研究综述 