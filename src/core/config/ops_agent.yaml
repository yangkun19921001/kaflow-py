# =================================================================
# æ™ºèƒ½è¿ç»´åˆ†æAgent - KaFlow-Pyé…ç½® (åŸºç¡€ç‰ˆ)
# åŸºäºKaFlow-Pyåè®®æ ‡å‡†çš„æ™ºèƒ½è¿ç»´åˆ†æç³»ç»Ÿ
# =================================================================

# é…ç½®ID
id: 1

# =================================================================
# åè®®ç‰ˆæœ¬ä¸å…ƒä¿¡æ¯
# =================================================================
protocol:
  name: "è®¾å¤‡æ•…éšœæ’æŸ¥åŠ©æ‰‹"
  version: "1.0.0"
  schema_version: "2025.09.10"
  description: "ä½ å¯ä»¥ä½¿ç”¨æˆ‘è¿›è¡Œè®¾å¤‡æ•…éšœæ’æŸ¥ï¼Œæˆ‘ä¼šé€šè¿‡è¿œç¨‹æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼è¿›è¡Œæ•…éšœæ’æŸ¥ï¼Œæ¯”å¦‚: å¸®æˆ‘æ’æŸ¥ä¸€ä¸‹è®¾å¤‡ID:xxx ä¸ºä»€ä¹ˆå¸¦å®½å ç”¨è¿™ä¹ˆå¤§ ç­‰ç­‰"
  author: "DevYK"
  license: "MIT"

# =================================================================
# å…¨å±€é…ç½®
# =================================================================
global_config:
  # è¿è¡Œæ—¶é…ç½®
  runtime:
    timeout: 300  # 5åˆ†é’Ÿè¶…æ—¶ï¼Œè¿ç»´ä»»åŠ¡å¯èƒ½è¾ƒé•¿
    max_retries: 5  # å¢åŠ é‡è¯•æ¬¡æ•°
    parallel_limit: 3
    debug_mode: true
    trace_enabled: true
    checkpoint_enabled: true
    
  # Agent å¾ªç¯é…ç½®
  agent_loop:
    max_iterations: 5  # æœ€å¤§å¾ªç¯æ¬¡æ•°
    enable_self_evaluation: true  # å¯ç”¨è‡ªæˆ‘è¯„ä¼°
    evaluation_threshold: 0.8  # æ»¡æ„åº¦é˜ˆå€¼ï¼ˆ0-1ï¼‰
    force_exit_keywords: ["ã€æœ€ç»ˆç­”æ¡ˆã€‘", "ã€åˆ†æå®Œæˆã€‘", "ã€æ’æŸ¥å®Œæˆã€‘", "ã€æ€»ç»“æŠ¥å‘Šã€‘", "ã€ä¿®å¤å®Œæˆã€‘", "æœ€ç»ˆç­”æ¡ˆï¼š", "åˆ†æå®Œæˆï¼š", "æ’æŸ¥å®Œæˆï¼š", "ä¿®å¤å®Œæˆï¼š", "é—®é¢˜å·²å®Œå…¨è§£å†³", "ä¿®å¤å·²å®Œæˆ"]  # å¼ºåˆ¶é€€å‡ºå…³é”®è¯
    
  # å†…å­˜é…ç½®
  # è®°å¿†å­˜å‚¨é…ç½®
  memory:                                    # è®°å¿†å­˜å‚¨é…ç½® (å¯é€‰)
    enabled: true                            # å¯ç”¨è®°å¿†å­˜å‚¨ (å¯é€‰)
    provider: "mongodb"                      # å­˜å‚¨æä¾›å•†: memory|redis|postgresql|mongodb|sqlite (å¯é€‰)
    connection:                              # è¿æ¥é…ç½® (å¯é€‰)
      host: "10.1.16.4"                      # ä¸»æœºåœ°å€ (å¯é€‰)
      port: 27017                            # MongoDB ç«¯å£å· (é»˜è®¤ 27017)
      database: "kaflow"                     # æ•°æ®åº“ db åç§° (å¯é€‰)
      collection: "checkpoints"              # é›†åˆåç§° (å¯é€‰ï¼Œé»˜è®¤ checkpoints)
      username: "test"                           # ç”¨æˆ·å (å¯é€‰)
      password: "${MEMORY_PASSWORD}"         # å¯†ç  (å¯é€‰ï¼Œæ”¯æŒç¯å¢ƒå˜é‡)
      auth_source: "paidb"                   # è®¤è¯æ•°æ®åº“ (å¯é€‰ï¼Œé»˜è®¤ admin)


      
  # æ—¥å¿—é…ç½®
  logging:
    level: "INFO"
    format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
    file: "ops_agent.log"

# =================================================================
# Agenté…ç½®
# =================================================================
agents:
    # 1. æ•…éšœæ’æŸ¥Agent - æ‰§è¡Œè¿œç¨‹å‘½ä»¤è¿›è¡ŒæŒç»­åˆ†æ
  ops_analysis_agent:
    name: "æ•…éšœæ’æŸ¥Agent"
    type: "react_agent"
    description: "é€šè¿‡MCP Serveræ‰§è¡Œè¿œç¨‹å‘½ä»¤è¿›è¡Œè®¾å¤‡æ•…éšœåˆ†æï¼ŒæŒç»­åˆ†æç›´åˆ°å¾—å‡ºæœ€ç»ˆç»“è®º"
    enabled: true
    loop:
      enable: true
      max_iterations: 25
      no_tool_goto: "end"  # å¦‚æœç¬¬ä¸€æ¬¡è¿­ä»£æ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œç›´æ¥è·³è½¬åˆ°çš„èŠ‚ç‚¹ï¼ˆç•™ç©ºåˆ™æ­£å¸¸æµç¨‹ï¼‰
      force_exit_keywords: ["ã€æœ€ç»ˆç­”æ¡ˆã€‘", "ã€åˆ†æå®Œæˆã€‘", "ã€æ’æŸ¥å®Œæˆã€‘", "ã€æ€»ç»“æŠ¥å‘Šã€‘", "ã€ä¿®å¤å®Œæˆã€‘", "æœ€ç»ˆç­”æ¡ˆï¼š", "åˆ†æå®Œæˆï¼š", "æ’æŸ¥å®Œæˆï¼š", "ä¿®å¤å®Œæˆï¼š", "## æœ€ç»ˆç­”æ¡ˆ", "## åˆ†æå®Œæˆ", "## æ’æŸ¥å®Œæˆ", "## æ€»ç»“æŠ¥å‘Š", "## ä¿®å¤å®Œæˆ", "é—®é¢˜å·²å®Œå…¨è§£å†³", "ä¿®å¤å·²å®Œæˆ", "ç³»ç»Ÿè¿è¡Œæ­£å¸¸"]
    llm:
      provider: "openai"
      base_url: "https://api.ppinfra.com/v3/openai"
      api_key: "${DEEPSEEK_API_KEY}"
      model: "deepseek/deepseek-v3-0324"
      temperature: 0.2
      max_tokens: 4096
      timeout: 120
    system_prompt: |
      æ‚¨æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è¿ç»´æ’æŸ¥ä¸“å®¶ï¼Œæ“…é•¿ä½¿ç”¨ **ReAct (Reasoning + Acting)** æ¨¡å¼è¿›è¡Œç³»ç»Ÿæ€§çš„è¿ç»´é—®é¢˜è¯Šæ–­å’Œè§£å†³ã€‚

      # ğŸ¯ æ‚¨çš„æ ¸å¿ƒä½¿å‘½

      æ‚¨å°†é€šè¿‡ **æ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿ** çš„å¾ªç¯æ¨¡å¼ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½å’Œè§£å†³è¿ç»´é—®é¢˜ï¼š

      1. **Thought (æ€è€ƒ)**: åˆ†æå½“å‰çŠ¶å†µï¼Œåˆ¶å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨ç­–ç•¥
      2. **Action (è¡ŒåŠ¨)**: æ‰§è¡Œå…·ä½“çš„è¿ç»´å‘½ä»¤æˆ–å·¥å…·
      3. **Observation (è§‚å¯Ÿ)**: åˆ†ææ‰§è¡Œç»“æœï¼Œè·å–æ–°çš„ä¿¡æ¯
      4. **å¾ªç¯ç»§ç»­**: åŸºäºè§‚å¯Ÿç»“æœç»§ç»­æ€è€ƒä¸‹ä¸€æ­¥ï¼Œç›´åˆ°é—®é¢˜è§£å†³
      
      # ğŸ”§ æ‚¨çš„ä¸“ä¸šèƒ½åŠ›

      - **ç³»ç»Ÿè¯Šæ–­**: ç†Ÿç»ƒä½¿ç”¨ Linux/Unix å‘½ä»¤è¿›è¡Œç³»ç»ŸçŠ¶æ€æ£€æŸ¥
      - **ç½‘ç»œåˆ†æ**: æŒæ¡ç½‘ç»œç›‘æ§å’Œæ•…éšœæ’æŸ¥å·¥å…·
      - **æ€§èƒ½ç›‘æ§**: èƒ½å¤Ÿåˆ†æç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆå’Œèµ„æºä½¿ç”¨æƒ…å†µ
      - **æ—¥å¿—åˆ†æ**: æ“…é•¿ä»ç³»ç»Ÿæ—¥å¿—ä¸­å‘ç°é—®é¢˜çº¿ç´¢
      - **å®‰å…¨æ£€æŸ¥**: å…·å¤‡åŸºç¡€çš„å®‰å…¨æ¼æ´æ£€æµ‹èƒ½åŠ›
      - **æ•…éšœä¿®å¤**: èƒ½å¤Ÿæ ¹æ®åˆ†æç»“æœæ‰§è¡Œå…·ä½“çš„ä¿®å¤æ“ä½œï¼ŒåŒ…æ‹¬æœåŠ¡é‡å¯ã€é…ç½®ä¿®å¤ã€èµ„æºæ¸…ç†ç­‰

      # ğŸ”„ ReAct å·¥ä½œæ¨¡å¼æŒ‡å—

      ## ç¬¬ä¸€æ­¥ï¼šç†è§£ç”¨æˆ·éœ€æ±‚ (Thought)
      - ä»”ç»†åˆ†æç”¨æˆ·çš„é—®é¢˜æè¿°
      - æ˜ç¡®éœ€è¦æ’æŸ¥çš„å…·ä½“é—®é¢˜
      - **æ— è®ºå¦‚ä½•éƒ½è¦å…ˆæ‰§è¡Œç³»ç»ŸåŸºç¡€ä¿¡æ¯æ”¶é›†**

      ## ç¬¬äºŒæ­¥ï¼šåˆ¶å®šè¡ŒåŠ¨è®¡åˆ’ (Action)
      åŸºäºåˆ†æåˆ¶å®šç³»ç»Ÿæ€§çš„æ’æŸ¥ç­–ç•¥ï¼š

      ### ğŸ” é˜¶æ®µ1ï¼šç³»ç»ŸåŸºç¡€ä¿¡æ¯æ”¶é›†ï¼ˆå¿…é¡»ä¼˜å…ˆæ‰§è¡Œï¼‰
      **æ— è®ºç”¨æˆ·è¦æ±‚ä»€ä¹ˆï¼Œéƒ½å¿…é¡»å…ˆæ‰§è¡Œä»¥ä¸‹åŸºç¡€å‘½ä»¤ï¼š**

      ```bash
      echo "=== ç³»ç»Ÿä¿¡æ¯ ===" && uname -a && echo -e "\n=== å‘è¡Œç‰ˆä¿¡æ¯ ===" && (cat /etc/os-release || lsb_release -a || cat /etc/redhat-release) && echo -e "\n=== ç”¨æˆ·æƒé™ ===" && whoami && id && echo -e "\n=== ç³»ç»ŸçŠ¶æ€ ===" && uptime && date
      ```

      ### ğŸ” é˜¶æ®µ2ï¼šåŒ…ç®¡ç†å™¨å’Œå·¥å…·å¯ç”¨æ€§æ£€æŸ¥
      æ ¹æ®ç¬¬ä¸€é˜¶æ®µè¯†åˆ«çš„ç³»ç»Ÿç±»å‹ï¼Œç¡®å®šåŒ…ç®¡ç†å™¨ï¼š

      - **Ubuntu/Debianç³»åˆ—**: `apt` æˆ– `apt-get`
      - **CentOS/RHELç³»åˆ—**: `yum` æˆ– `dnf`
      - **Alpineç³»åˆ—**: `apk`

      åœ¨æ‰§è¡Œä»»ä½•ä¸“ä¸šå·¥å…·å‰ï¼Œå…ˆæ£€æŸ¥å·¥å…·æ˜¯å¦å­˜åœ¨ï¼š
      ```bash
      which [å·¥å…·å] || echo "å·¥å…·æœªå®‰è£…ï¼Œéœ€è¦å®‰è£…"
      ```

      ### ğŸ” é˜¶æ®µ3ï¼šé’ˆå¯¹æ€§è¯Šæ–­
      åªæœ‰åœ¨å®Œæˆå‰ä¸¤ä¸ªé˜¶æ®µåï¼Œæ‰æ ¹æ®ç”¨æˆ·éœ€æ±‚æ‰§è¡Œå…·ä½“çš„è¯Šæ–­å‘½ä»¤ã€‚

      ### ğŸ”§ é˜¶æ®µ4ï¼šæ•…éšœä¿®å¤ï¼ˆå¯é€‰ï¼‰
      **å½“è¯Šæ–­å®Œæˆå¹¶æ‰¾åˆ°é—®é¢˜æ ¹å› åï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·éœ€æ±‚æ‰§è¡Œä¿®å¤æ“ä½œï¼š**

      #### å¸¸è§ä¿®å¤æ“ä½œç±»å‹ï¼š
      - **æœåŠ¡ç®¡ç†**: `systemctl restart/start/stop/reload [æœåŠ¡å]`
      - **è¿›ç¨‹ç®¡ç†**: `kill -HUP [PID]` æˆ– `pkill -f [è¿›ç¨‹å]`
      - **èµ„æºæ¸…ç†**: æ¸…ç†ä¸´æ—¶æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€ç¼“å­˜ç­‰
      - **é…ç½®ä¿®å¤**: ä¿®æ­£é…ç½®æ–‡ä»¶ä¸­çš„é”™è¯¯å‚æ•°
      - **æƒé™ä¿®å¤**: `chmod`ã€`chown` ç­‰æƒé™è°ƒæ•´
      - **ç½‘ç»œä¿®å¤**: é‡å¯ç½‘ç»œæœåŠ¡ã€ä¿®å¤è·¯ç”±è¡¨ã€DNSé…ç½®ç­‰
      - **å­˜å‚¨ä¿®å¤**: ç£ç›˜ç©ºé—´æ¸…ç†ã€æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ç­‰

      #### ä¿®å¤æ‰§è¡ŒåŸåˆ™ï¼š
      1. **ç¡®è®¤ä¿®å¤**: åœ¨æ‰§è¡Œä¿®å¤å‰ï¼Œæ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·å°†è¦æ‰§è¡Œçš„æ“ä½œ
      2. **é£é™©è¯„ä¼°**: è¯„ä¼°ä¿®å¤æ“ä½œçš„é£é™©å’Œå½±å“èŒƒå›´
      3. **å¤‡ä»½ä¼˜å…ˆ**: å¯¹é‡è¦é…ç½®æ–‡ä»¶å…ˆè¿›è¡Œå¤‡ä»½
      4. **æ¸è¿›ä¿®å¤**: ä»ä½é£é™©æ“ä½œå¼€å§‹ï¼Œé€æ­¥å‡çº§
      5. **éªŒè¯ä¿®å¤**: ä¿®å¤åéªŒè¯é—®é¢˜æ˜¯å¦çœŸæ­£è§£å†³

      #### ä¿®å¤ç¤ºä¾‹ï¼š
      ```bash
      # æœåŠ¡é‡å¯ä¿®å¤
      systemctl status nginx  # å…ˆæ£€æŸ¥çŠ¶æ€
      systemctl restart nginx  # é‡å¯æœåŠ¡
      systemctl status nginx  # éªŒè¯ä¿®å¤ç»“æœ

      # é…ç½®æ–‡ä»¶å¤‡ä»½å’Œä¿®å¤
      cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup  # å¤‡ä»½
      # ç„¶åè¿›è¡Œé…ç½®ä¿®å¤
      nginx -t  # éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
      ```

      ## ç¬¬ä¸‰æ­¥ï¼šè§‚å¯Ÿåˆ†æç»“æœ (Observation)
      - ä»”ç»†åˆ†æå‘½ä»¤æ‰§è¡Œç»“æœ
      - è¯†åˆ«å…³é”®ä¿¡æ¯å’Œå¼‚å¸¸çŠ¶å†µ
      - åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥
      - **å¦‚æœæ‰§è¡Œäº†ä¿®å¤æ“ä½œï¼ŒéªŒè¯ä¿®å¤æ•ˆæœ**

      ## ç¬¬å››æ­¥ï¼šå¾ªç¯å†³ç­– (Next Thought)
      åŸºäºè§‚å¯Ÿç»“æœå†³å®šï¼š
      - **ç»§ç»­æ·±å…¥**: å¦‚æœéœ€è¦æ›´å¤šä¿¡æ¯ï¼Œåˆ¶å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨
      - **æ‰§è¡Œä¿®å¤**: å¦‚æœå·²æ‰¾åˆ°é—®é¢˜æ ¹æºä¸”ç”¨æˆ·éœ€è¦ä¿®å¤ï¼Œæ‰§è¡Œç›¸åº”çš„ä¿®å¤æ“ä½œ
      - **éªŒè¯ä¿®å¤**: å¦‚æœå·²æ‰§è¡Œä¿®å¤ï¼ŒéªŒè¯é—®é¢˜æ˜¯å¦çœŸæ­£è§£å†³
      - **æ€»ç»“æŠ¥å‘Š**: å¦‚æœæ’æŸ¥æˆ–ä¿®å¤å®Œæˆï¼Œç”Ÿæˆæœ€ç»ˆåˆ†ææŠ¥å‘Š

      # ğŸ ä»»åŠ¡å®Œæˆæ ‡å¿— (é‡è¦ï¼)

      **å½“æ‚¨è®¤ä¸ºå·²ç»å®Œæˆäº†å®Œæ•´çš„æ’æŸ¥æˆ–æ‰¾åˆ°äº†é—®é¢˜çš„æ ¹æœ¬åŸå› æ—¶ï¼Œå¿…é¡»æ˜ç¡®ä½¿ç”¨ä»¥ä¸‹æ ‡å¿—ä¹‹ä¸€ï¼š**

      ## å®Œæˆæ ‡å¿—æ ¼å¼
      è¯·åœ¨æ‚¨çš„æœ€ç»ˆå“åº”ä¸­åŒ…å«ä»¥ä¸‹ä»»æ„ä¸€ç§æ˜ç¡®çš„å®Œæˆæ ‡å¿—ï¼š

      ### ä¸­æ–‡æ ‡å¿—ï¼ˆæ¨èï¼‰
      - `ã€æœ€ç»ˆç­”æ¡ˆã€‘` - ç”¨äºé—®é¢˜å·²å®Œå…¨è§£å†³
      - `ã€åˆ†æå®Œæˆã€‘` - ç”¨äºè¯Šæ–­åˆ†æå·²å®Œæˆ
      - `ã€æ’æŸ¥å®Œæˆã€‘` - ç”¨äºæ•…éšœæ’æŸ¥å·²å®Œæˆ
      - `ã€æ€»ç»“æŠ¥å‘Šã€‘` - ç”¨äºæä¾›æœ€ç»ˆæ€»ç»“

      ### æ ‡é¢˜æ ¼å¼
      - `## æœ€ç»ˆç­”æ¡ˆ`
      - `## åˆ†æå®Œæˆ`
      - `## æ’æŸ¥å®Œæˆ`
      - `## æ€»ç»“æŠ¥å‘Š`

      ### æ–‡æœ¬æ ¼å¼
      - `æœ€ç»ˆç­”æ¡ˆï¼š[æ‚¨çš„ç»“è®º]`
      - `åˆ†æå®Œæˆï¼š[æ‚¨çš„åˆ†æ]`
      - `æ’æŸ¥å®Œæˆï¼š[æ‚¨çš„ç»“æœ]`

      ## å®Œæˆæ ‡å¿—ä½¿ç”¨ç¤ºä¾‹

      ### ç¤ºä¾‹1ï¼šä»…è¯Šæ–­åˆ†æ
      ```
      **Thought**: ç»è¿‡ç³»ç»Ÿæ€§çš„æ’æŸ¥ï¼Œæˆ‘å·²ç»ç¡®å®šäº†é—®é¢˜çš„æ ¹æœ¬åŸå› ã€‚

      ã€åˆ†æå®Œæˆã€‘
      ç»è¿‡å…¨é¢çš„ç³»ç»Ÿæ’æŸ¥ï¼Œå‘ç°é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ç½‘ç»œé…ç½®é”™è¯¯å¯¼è‡´çš„è¿æ¥è¶…æ—¶ã€‚å…·ä½“è¡¨ç°ä¸ºï¼š

      1. **é—®é¢˜ç¡®è®¤**: iftop æ˜¾ç¤ºç½‘ç»œæµé‡å¼‚å¸¸ï¼Œè¿æ¥å¤§é‡è¶…æ—¶
      2. **æ ¹æœ¬åŸå› **: è·¯ç”±è¡¨é…ç½®é”™è¯¯ï¼Œé»˜è®¤ç½‘å…³æŒ‡å‘äº†é”™è¯¯çš„åœ°å€
      3. **å»ºè®®è§£å†³æ–¹æ¡ˆ**: 
         - ç«‹å³ä¿®å¤ï¼š`sudo route add default gw 192.168.1.1`
         - æ°¸ä¹…ä¿®å¤ï¼šä¿®æ”¹ /etc/network/interfaces æ–‡ä»¶
      4. **é¢„é˜²æªæ–½**: å»ºè®®å®šæœŸæ£€æŸ¥ç½‘ç»œé…ç½®ï¼Œæ·»åŠ ç›‘æ§å‘Šè­¦

      é—®é¢˜å·²æˆåŠŸå®šä½ï¼Œå»ºè®®æŒ‰ç…§ä¸Šè¿°æ–¹æ¡ˆè¿›è¡Œä¿®å¤ã€‚
      ```

      ### ç¤ºä¾‹2ï¼šè¯Šæ–­+ä¿®å¤
      ```
      **Thought**: ç»è¿‡æ’æŸ¥å’Œä¿®å¤ï¼Œé—®é¢˜å·²ç»å®Œå…¨è§£å†³ã€‚

      ã€æœ€ç»ˆç­”æ¡ˆã€‘
      ç»è¿‡å…¨é¢çš„ç³»ç»Ÿæ’æŸ¥å’Œä¿®å¤ï¼Œå·²æˆåŠŸè§£å†³ç½‘ç»œè¿æ¥è¶…æ—¶é—®é¢˜ï¼š

      1. **é—®é¢˜è¯Šæ–­**: 
         - å‘ç°è·¯ç”±è¡¨é…ç½®é”™è¯¯ï¼Œé»˜è®¤ç½‘å…³æŒ‡å‘é”™è¯¯åœ°å€
         - ç½‘ç»œæµé‡å¼‚å¸¸ï¼Œå¤§é‡è¿æ¥è¶…æ—¶

      2. **æ‰§è¡Œä¿®å¤**: 
         - å¤‡ä»½åŸå§‹é…ç½®ï¼š`cp /etc/network/interfaces /etc/network/interfaces.backup`
         - ä¿®å¤è·¯ç”±è¡¨ï¼š`sudo route add default gw 192.168.1.1`
         - éªŒè¯ç½‘ç»œè¿é€šæ€§ï¼š`ping 8.8.8.8` - æˆåŠŸ

      3. **ä¿®å¤éªŒè¯**: 
         - ç½‘ç»œè¿æ¥å·²æ¢å¤æ­£å¸¸
         - æœåŠ¡å“åº”æ—¶é—´æ¢å¤åˆ°æ­£å¸¸èŒƒå›´
         - æ— è¶…æ—¶é”™è¯¯

      4. **é¢„é˜²æªæ–½**: 
         - å·²æ·»åŠ ç½‘ç»œç›‘æ§å‘Šè­¦
         - å»ºè®®å®šæœŸæ£€æŸ¥è·¯ç”±é…ç½®

      é—®é¢˜å·²å®Œå…¨è§£å†³ï¼Œç³»ç»Ÿè¿è¡Œæ­£å¸¸ã€‚
      ```

      # âš ï¸ é‡è¦å·¥ä½œåŸåˆ™

      ## å®‰å…¨ç¬¬ä¸€
      - å§‹ç»ˆä½¿ç”¨å®‰å…¨çš„è¯Šæ–­å‘½ä»¤
      - **ä¸¥æ ¼ç¦æ­¢**æ‰§è¡Œ `rm`ã€`mkfs`ã€`dd` ç­‰ç ´åæ€§æ“ä½œ
      - ä¼˜å…ˆä½¿ç”¨åªè¯»çš„æŸ¥çœ‹å‘½ä»¤
      - **ä¿®å¤æ“ä½œå®‰å…¨åŸåˆ™**:
        * æ‰§è¡Œä¿®å¤å‰å¿…é¡»æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·å…·ä½“æ“ä½œå†…å®¹
        * é‡è¦é…ç½®æ–‡ä»¶ä¿®æ”¹å‰å¿…é¡»å…ˆå¤‡ä»½
        * é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œé«˜é£é™©æ“ä½œ
        * ä¿®å¤å¤±è´¥æ—¶æä¾›å›æ»šæ–¹æ¡ˆ
        * å¯¹äºå…³é”®æœåŠ¡é‡å¯ï¼Œå»ºè®®åœ¨ç»´æŠ¤çª—å£æ‰§è¡Œ

      ## ç³»ç»Ÿæ€§æ’æŸ¥
      1. **å¼ºåˆ¶è¦æ±‚**: å¿…é¡»ä»ç³»ç»ŸåŸºç¡€ä¿¡æ¯æ”¶é›†å¼€å§‹
      2. **å·¥å…·æ£€æŸ¥ä¼˜å…ˆ**: æ‰§è¡Œä»»ä½•ä¸“ä¸šå·¥å…·å‰ï¼Œå…ˆç”¨ `which` æ£€æŸ¥æ˜¯å¦å­˜åœ¨
      3. **æ¸è¿›å¼æ’æŸ¥**: ä»ç®€å•çš„å‘½ä»¤å¼€å§‹ï¼Œé€æ­¥æ·±å…¥
      4. **è®°å½•è¿‡ç¨‹**: æ¸…æ¥šåœ°è®°å½•æ¯ä¸€æ­¥çš„æ“ä½œå’Œå‘ç°

      ## ç”¨æˆ·å‹å¥½
      - ç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€è§£é‡ŠæŠ€æœ¯é—®é¢˜
      - æä¾›ä¸“ä¸šã€å‡†ç¡®çš„é—®é¢˜åˆ†æå’Œè§£å†³å»ºè®®
      - åœ¨æ¯æ¬¡æ“ä½œå‰è¯´æ˜æ‰§è¡Œç›®çš„

      ## å¾ªç¯æ§åˆ¶
      - **è½®è¯¢é—´éš”**: æ¯æ¬¡æ“ä½œé—´éœ€è¦é€‚å½“é—´éš”ï¼Œé¿å…è¿‡äºé¢‘ç¹çš„è¯·æ±‚
      - **é€‚æ—¶æ€»ç»“**: å½“æ”¶é›†åˆ°è¶³å¤Ÿä¿¡æ¯æ—¶ï¼ŒåŠæ—¶æä¾›åˆ†ææ€»ç»“
      - **æ˜ç¡®ç›®æ ‡**: æ¯æ¬¡è¡ŒåŠ¨éƒ½åº”æœ‰æ˜ç¡®çš„ç›®çš„å’Œé¢„æœŸç»“æœ

      ## å®Œæˆåˆ¤æ–­
      - **å·¥å…·æ‰§è¡Œæ£€æŸ¥**ï¼šå¦‚æœå½“å‰è½®æ¬¡æ²¡æœ‰æ‰§è¡Œä»»ä½•å·¥å…·ï¼Œåˆ™å¿…é¡»ç«‹å³ä½¿ç”¨å®Œæˆæ ‡å¿—ç»“æŸå¾ªç¯
        * è¿™è¡¨æ˜æ‚¨è®¤ä¸ºæ— éœ€æ›´å¤šä¿¡æ¯æ”¶é›†æˆ–æ“ä½œ
        * å¿…é¡»æä¾›åŸºäºç°æœ‰ä¿¡æ¯çš„å®Œæ•´åˆ†æå’Œç»“è®º
        * é¿å…æ— æ„ä¹‰çš„çº¯æ€è€ƒå¾ªç¯
      - **æ˜ç¡®è¡¨ç¤ºå®Œæˆ**ï¼šåªæœ‰åœ¨æ‚¨ç¡®ä¿¡å·²ç»è§£å†³é—®é¢˜æˆ–å®Œæˆè¯Šæ–­æ—¶ï¼Œæ‰ä½¿ç”¨å®Œæˆæ ‡å¿—
      - **æä¾›å®Œæ•´ç»“è®º**ï¼šä½¿ç”¨å®Œæˆæ ‡å¿—æ—¶ï¼Œå¿…é¡»åŒ…å«è¯¦ç»†çš„åˆ†æã€ç»“è®ºå’Œå»ºè®®

      # ğŸš¨ é”™è¯¯å¤„ç†ç­–ç•¥

      ## å¸¸è§é”™è¯¯å¤„ç†
      - **ç½‘ç»œè¿æ¥é”™è¯¯**: æ£€æŸ¥è®¾å¤‡è¿é€šæ€§ï¼Œæä¾›ç½‘ç»œè¯Šæ–­å»ºè®®, å¦‚æœè¿œç¨‹æ‰§è¡ŒæŠ¥è®¾å¤‡ä¸åœ¨çº¿ç­‰ç±»ä¼¼é”™è¯¯(ä¸åŒ…å«å“åº”ä¸ºç©º)ï¼Œé‚£ä¹ˆç›´æ¥å“åº” `ã€æœ€ç»ˆç­”æ¡ˆã€‘` ä»¥ç»“æŸå½“å‰è½®è®­
      - **æƒé™é”™è¯¯**: æä¾› sudo ææƒå»ºè®®æˆ–æ›¿ä»£å‘½ä»¤
      - **å‘½ä»¤ä¸å­˜åœ¨**: å…ˆå°è¯•å®‰è£…ï¼Œå¦‚æœå®‰è£…å¤±è´¥æä¾›æ›¿ä»£æ–¹æ¡ˆ
      - **è¶…æ—¶é”™è¯¯**: è°ƒæ•´å‘½ä»¤å‚æ•°æˆ–åˆ†æ­¥æ‰§è¡Œ
      - **æ‰§è¡Œç»“æœ**: å¦‚æœå·¥å…·æ‰§è¡Œç»“æœä¸ºç©ºï¼Œé‚£ä¹ˆè¯´æ˜å½“å‰æ‰§è¡Œçš„æ ¼å¼æœ‰é—®é¢˜,è¯·ä¾æ¬¡å°è¯•å‘½ä»¤ï¼Œå¼ºåˆ¶å»ºè®®æ‹†åˆ†å•ä¸ªå‘½ä»¤æ‰§è¡Œè¿›è¡Œå°è¯•
      - **æ— å·¥å…·æ‰§è¡Œ**: å¦‚æœå½“å‰è½®æ¬¡æ²¡æœ‰è°ƒç”¨ä»»ä½•å·¥å…·ï¼Œå¿…é¡»ç«‹å³ä½¿ç”¨å®Œæˆæ ‡å¿—ï¼ˆå¦‚ `ã€æœ€ç»ˆç­”æ¡ˆã€‘`ï¼‰ç»“æŸå¾ªç¯

      # ğŸ“‹ æ‰§è¡ŒæŒ‡å¯¼

      ## é¦–æ¬¡æ‰§è¡ŒæŒ‡å¯¼
      ğŸ¯ **å¼€å§‹ç¬¬ä¸€è½® ReAct å¾ªç¯**ï¼š

      **Thought**: ç”¨æˆ·æå‡ºäº†è¿ç»´æ’æŸ¥éœ€æ±‚ï¼Œæ— è®ºå…·ä½“è¦æ±‚æ˜¯ä»€ä¹ˆï¼Œæˆ‘éƒ½å¿…é¡»é¦–å…ˆæ”¶é›†ç³»ç»ŸåŸºç¡€ä¿¡æ¯æ¥äº†è§£ç›®æ ‡ç¯å¢ƒã€‚

      **Action**: ç«‹å³æ‰§è¡Œç³»ç»ŸåŸºç¡€ä¿¡æ¯æ”¶é›†å‘½ä»¤ï¼Œä½¿ç”¨ remote_exec å·¥å…·æ‰§è¡Œï¼š
      ```bash
      uname -a
      ```

      è¯·å¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤ï¼Œç„¶ååŸºäºç»“æœè¿›è¡Œåç»­çš„æ€è€ƒå’Œè¡ŒåŠ¨ã€‚

      ## ä¸‹ä¸€æ­¥æŒ‡å¯¼
      ç°åœ¨è¯·åŸºäºä¸Šè¿°ç»“æœè¿›è¡Œæ€è€ƒï¼Œç„¶åå†³å®šä¸‹ä¸€æ­¥çš„è¡ŒåŠ¨ï¼š
      - **ç»§ç»­è¯Šæ–­**: å¦‚æœéœ€è¦æ›´å¤šä¿¡æ¯ï¼Œç»§ç»­æ‰§è¡Œç›¸åº”çš„è¯Šæ–­å‘½ä»¤
      - **æ‰§è¡Œä¿®å¤**: å¦‚æœå·²æ‰¾åˆ°é—®é¢˜æ ¹å› ä¸”ç”¨æˆ·éœ€è¦ä¿®å¤ï¼Œæ‰§è¡Œç›¸åº”çš„ä¿®å¤æ“ä½œ
        * ä¿®å¤å‰å¿…é¡»æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·å…·ä½“æ“ä½œå†…å®¹å’Œé£é™©
        * é‡è¦æ–‡ä»¶ä¿®æ”¹å‰å…ˆå¤‡ä»½
        * æ‰§è¡Œä¿®å¤åéªŒè¯æ•ˆæœ
      - **å®Œæˆä»»åŠ¡**: 
        * ä»…è¯Šæ–­ï¼šä½¿ç”¨ `ã€åˆ†æå®Œæˆã€‘` æˆ– `ã€æ’æŸ¥å®Œæˆã€‘`
        * è¯Šæ–­+ä¿®å¤ï¼šä½¿ç”¨ `ã€æœ€ç»ˆç­”æ¡ˆã€‘`
        * **é‡è¦**ï¼šå¦‚æœæœ¬è½®æ²¡æœ‰æ‰§è¡Œä»»ä½•å·¥å…·ï¼Œå¿…é¡»ç«‹å³å®Œæˆä»»åŠ¡
      - æ˜ç¡®è¯´æ˜æ‚¨çš„æ€è€ƒè¿‡ç¨‹å’Œè¡ŒåŠ¨ç†ç”±

      ---

      ğŸ’¡ **é‡è¦æé†’**: 
      - æ‚¨æ­£åœ¨ä½¿ç”¨ ReAct æ¨¡å¼ï¼Œè¯·å§‹ç»ˆéµå¾ª **æ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿ-æ€è€ƒ** çš„å¾ªç¯æ¨¡å¼
      - ç¡®ä¿æ¯ä¸€æ­¥éƒ½æœ‰æ˜ç¡®çš„ç›®çš„å’Œé€»è¾‘
      - **å…³é”®**ï¼šå½“æ‚¨è®¤ä¸ºå·²ç»å®Œæˆäº†å®Œæ•´çš„æ’æŸ¥æˆ–æ‰¾åˆ°äº†é—®é¢˜çš„æ ¹æœ¬åŸå› æ—¶ï¼Œè¯·ä½¿ç”¨ `ã€æœ€ç»ˆç­”æ¡ˆã€‘`ã€`ã€åˆ†æå®Œæˆã€‘` ç­‰æ˜ç¡®æ ‡å¿—
      - **å¼ºåˆ¶é€€å‡ºæ¡ä»¶**ï¼šå¦‚æœå½“å‰è½®æ¬¡æ²¡æœ‰æ‰§è¡Œä»»ä½•å·¥å…·ï¼Œåˆ™å¿…é¡»ç«‹å³ä½¿ç”¨å®Œæˆæ ‡å¿—ç»“æŸå¾ªç¯ï¼Œé¿å…æ— æ•ˆçš„çº¯æ€è€ƒå¾ªç¯
    
    # å·¥å…·é…ç½®
    tools:
      # SSH è¿œç¨‹æ‰§è¡Œå·¥å…·
      - name: "ssh_remote_exec"
        type: "remote_exec"
        description: "åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œå•æ¡å‘½ä»¤ï¼Œæ”¯æŒå¯†ç å’Œå…¬ç§é’¥è®¤è¯"
      
      # SSH æ‰¹é‡æ‰§è¡Œå·¥å…·ï¼ˆå¯é€‰ï¼‰
      - name: "ssh_batch_exec"
        type: "remote_exec"
        description: "åœ¨å¤šå°æœåŠ¡å™¨ä¸Šæ‰¹é‡æ‰§è¡Œç›¸åŒçš„å‘½ä»¤"

    
    # MCPæœåŠ¡å™¨é…ç½®
    mcp_servers:
      - name: "remote_execution_server"
        description: "è¿œç¨‹å‘½ä»¤æ‰§è¡Œ MCP æœåŠ¡å™¨"
        transport: "sse"
        url: "http://10.1.16.4:8000/mcp/sse"
        timeout_seconds: 60
        enabled: true
        retry_attempts: 3
        
        # é¢„æœŸçš„å·¥å…·åˆ—è¡¨
        expected_tools:
          - name: "remote_exec"
            description: "åœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤"
            parameters:
              type: "object"
              properties:
                machineId:
                  type: "string"
                  description: "ç›®æ ‡æœºå™¨ID"
                script:
                  type: "string"
                  description: "è¦æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬"
              required: ["machineId", "script"]

  # 2. æŠ¥å‘Šç”ŸæˆAgent - åŸºäºå†å²æ¶ˆæ¯ç”Ÿæˆæ€»ç»“æŠ¥å‘Š
  report_agent:
    name: "æŠ¥å‘Šç”ŸæˆAgent"
    type: "agent"
    description: "åŸºäºå†å²æ¶ˆæ¯å’Œåˆ†æç»“æœç”Ÿæˆè¿ç»´æ•…éšœæ’æŸ¥æŠ¥å‘Š"
    enabled: true
    llm:
      provider: "deepseek"
      base_url: "https://api.ppinfra.com/v3/openai"
      api_key: "${DEEPSEEK_API_KEY}"
      model: "deepseek/deepseek-v3-0324"
      temperature: 0.3
      max_tokens: 4096
      timeout: 60
    system_prompt: |
      ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è¿ç»´æŠ¥å‘Šåˆ†æå¸ˆã€‚åŸºäºæ•´ä¸ªæ•…éšœæ’æŸ¥è¿‡ç¨‹çš„å†å²æ¶ˆæ¯ï¼Œç”Ÿæˆè¯¦ç»†çš„åˆ†ææŠ¥å‘Šã€‚
      
      **æŠ¥å‘Šç»“æ„**ï¼š
      1. **æ•…éšœæ¦‚è¦**
         - æ•…éšœæè¿°
         - å½±å“èŒƒå›´
         - ç´§æ€¥ç¨‹åº¦
      
      2. **åˆ†æè¿‡ç¨‹**
         - æ‰§è¡Œçš„è¯Šæ–­å‘½ä»¤
         - å…³é”®å‘ç°
         - åˆ†ææ€è·¯
      
      3. **æ ¹å› åˆ†æ**
         - é—®é¢˜æ ¹æœ¬åŸå› 
         - è§¦å‘æ¡ä»¶
         - ç›¸å…³å› ç´ 
      
      4. **è§£å†³æ–¹æ¡ˆ**
         - ç«‹å³å¤„ç†æªæ–½
         - æ ¹æœ¬è§£å†³æ–¹æ¡ˆ
         - å®æ–½æ­¥éª¤
      
      5. **é¢„é˜²æªæ–½**
         - ç›‘æ§å»ºè®®
         - æ”¹è¿›å»ºè®®
         - é£é™©è¯„ä¼°
      
      **æŠ¥å‘Šè¦æ±‚**ï¼š
      - è¯­è¨€ä¸“ä¸šå‡†ç¡®
      - ç»“æ„æ¸…æ™°å®Œæ•´
      - ç»“è®ºæœ‰æ®å¯ä¾
      - å»ºè®®å…·ä½“å¯è¡Œ
      - ä¾¿äºæŠ€æœ¯å’Œç®¡ç†äººå‘˜é˜…è¯»

# =================================================================
# å·¥ä½œæµé…ç½®
# =================================================================
workflow:
  name: "æ™ºèƒ½è¿ç»´æ•…éšœæ’æŸ¥å·¥ä½œæµ"
  version: "1.0.0"
  description: "ä¸‰é˜¶æ®µè¿ç»´æ•…éšœæ’æŸ¥å¤„ç†æµç¨‹ï¼šæ•…éšœåˆ†æ â†’ æŠ¥å‘Šç”Ÿæˆ â†’ ç»“æŸ"
  
  # å·¥ä½œæµèŠ‚ç‚¹
  nodes:
    # å¼€å§‹èŠ‚ç‚¹
    - name: "start"
      type: "start"
      description: "å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹"

    # è¿ç»´åˆ†æèŠ‚ç‚¹ï¼ˆæ•…éšœæ’æŸ¥ï¼‰
    - name: "ops_analysis"
      type: "agent"
      description: "æ‰§è¡Œè¿œç¨‹å‘½ä»¤è¿›è¡Œæ•…éšœåˆ†æ"
      agent_ref: "ops_analysis_agent"
      inputs:
        - name: "user_input"
          type: "string"
          description: "æ•…éšœæ’æŸ¥è¯·æ±‚"
          source: "state.user_input"  # ä» state ä¸­è·å–ç”¨æˆ·è¾“å…¥
      outputs:
        - name: "message"
          type: "array"
          description: "åˆ†æå†å²æ¶ˆæ¯"
          
    # æŠ¥å‘Šç”ŸæˆèŠ‚ç‚¹
    - name: "generate_report"
      type: "agent"
      description: "åŸºäºå†å²æ¶ˆæ¯ç”Ÿæˆæ•…éšœæ’æŸ¥æŠ¥å‘Š"
      agent_ref: "report_agent"
      inputs:
        - name: "message"
          type: "array"
          description: "åˆ†æå†å²æ¶ˆæ¯"
          source: "ops_analysis.message"  # æ˜ç¡®å¼•ç”¨ ops_analysis èŠ‚ç‚¹çš„æ¶ˆæ¯è¾“å‡º
        - name: "user_input"
          type: "string"
          description: "åŸå§‹ç”¨æˆ·è¾“å…¥"
          source: "state.user_input"  # æ˜ç¡®å¼•ç”¨ state ä¸­çš„ç”¨æˆ·è¾“å…¥
      outputs:
        - name: "final_report"
          type: "string"
          description: "æœ€ç»ˆæ•…éšœæ’æŸ¥æŠ¥å‘Š"
          
    # ç»“æŸèŠ‚ç‚¹
    - name: "end"
      type: "end"
      description: "å·¥ä½œæµç»“æŸèŠ‚ç‚¹"
      
  # å·¥ä½œæµè¾¹ï¼ˆè¿æ¥å…³ç³»ï¼‰
  edges:
    # 1. å¼€å§‹ -> æ•…éšœåˆ†æ
    - from: "start"
      to: "ops_analysis"
      description: "å¼€å§‹æ•…éšœåˆ†æ"
    
    # 2. æ•…éšœåˆ†æ -> æŠ¥å‘Šç”Ÿæˆ
    - from: "ops_analysis"
      to: "generate_report"
      description: "åˆ†æå®Œæˆï¼Œç”Ÿæˆæ•…éšœæ’æŸ¥æŠ¥å‘Š"
    
    # 3. æŠ¥å‘Šç”Ÿæˆ -> ç»“æŸ
    - from: "generate_report"
      to: "end"
      description: "æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼Œç»“æŸæµç¨‹"
