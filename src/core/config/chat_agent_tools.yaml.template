# =================================================================
# KaFlow-Py èŠå¤©æœºå™¨äººæ¨¡ç‰ˆ (å¸¦å·¥å…·ç‰ˆæœ¬)
# åŸºäº KaFlow-Py åè®®æ ‡å‡†çš„æ™ºèƒ½èŠå¤© Agent é…ç½®ï¼Œé›†æˆå¤šç§å®ç”¨å·¥å…·
# =================================================================

# =================================================================
# åè®®ç‰ˆæœ¬ä¸å…ƒä¿¡æ¯
# =================================================================
protocol:
  name: "KaFlow-Py Chat Agent with Tools Template"
  version: "1.0.0"
  schema_version: "2025.09.10"
  description: "åŸºäº KaFlow-Py åè®®æ ‡å‡†çš„æ™ºèƒ½èŠå¤©æœºå™¨äººæ¨¡ç‰ˆï¼Œé›†æˆæ–‡ä»¶æ“ä½œã€ç³»ç»Ÿä¿¡æ¯ã€è®¡ç®—å™¨ç­‰å·¥å…·"
  author: "DevYK"
  license: "MIT"

# =================================================================
# å…¨å±€é…ç½®
# =================================================================
global_config:
  # è¿è¡Œæ—¶é…ç½®
  runtime:
    timeout: 180
    max_retries: 3
    parallel_limit: 2
    debug_mode: false
    trace_enabled: true
    checkpoint_enabled: true

  # æ—¥å¿—é…ç½®
  logging:
    level: "INFO"
    format: "json"
    output: "stdout"
    file_path: "./logs/chat_agent_tools.log"
    max_size: "50MB"
    max_files: 5

# =================================================================
# Agent é…ç½® (ç¬¦åˆ agent_schema.base_structure)
# =================================================================
agents:
  chat_agent_with_tools:
    name: "chat_agent_with_tools"                  # Agent åç§°
    type: "react_agent"                                  # Agent ç±»å‹ï¼Œä½¿ç”¨ ReAct æ”¯æŒå·¥å…·
    description: "æ™ºèƒ½èŠå¤©æœºå™¨äººï¼Œæ”¯æŒæ–‡ä»¶æ“ä½œã€ç³»ç»ŸæŸ¥è¯¢ã€æ•°å­¦è®¡ç®—ç­‰åŠŸèƒ½"
    enabled: true                                  # æ˜¯å¦å¯ç”¨
    
    system_prompt: |                               # ç³»ç»Ÿæç¤ºè¯
      ä½ æ˜¯ä¸€ä¸ªå¼ºå¤§çš„AIåŠ©æ‰‹ï¼Œå…·å¤‡å¤šç§å®ç”¨å·¥å…·ã€‚ä½ çš„ä»»åŠ¡æ˜¯ï¼š
      
      1. ç†è§£ç”¨æˆ·çš„é—®é¢˜å’Œéœ€æ±‚
      2. åˆç†ä½¿ç”¨å¯ç”¨çš„å·¥å…·æ¥å¸®åŠ©ç”¨æˆ·è§£å†³é—®é¢˜
      3. æä¾›å‡†ç¡®ã€æœ‰ç”¨çš„å›ç­”å’Œæ“ä½œç»“æœ
      4. ä¿æŒå¯¹è¯çš„è¿è´¯æ€§å’Œä¸Šä¸‹æ–‡ç†è§£
      5. ç”¨æ¸©å’Œã€ä¸“ä¸šçš„è¯­æ°”ä¸ç”¨æˆ·äº¤æµ
      
      å¯ç”¨å·¥å…·è¯´æ˜ï¼š
      - file_reader: è¯»å–æ–‡ä»¶å†…å®¹
      - file_writer: å†™å…¥æ–‡ä»¶å†…å®¹  
      - system_info: è·å–ç³»ç»Ÿä¿¡æ¯
      - calculator: è¿›è¡Œæ•°å­¦è®¡ç®—
      - current_time: è·å–å½“å‰æ—¶é—´
      
      ä½¿ç”¨å·¥å…·æ—¶è¯·ï¼š
      - æ ¹æ®ç”¨æˆ·éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·
      - æ¸…æ¥šè§£é‡Šä½ è¦æ‰§è¡Œçš„æ“ä½œ
      - æ€»ç»“å·¥å…·æ‰§è¡Œçš„ç»“æœ
      - å¦‚æœæ“ä½œå¤±è´¥ï¼Œæä¾›æ›¿ä»£æ–¹æ¡ˆ
      
      è¯·å§‹ç»ˆè®°ä½ä¹‹å‰çš„å¯¹è¯å†…å®¹ï¼Œå¹¶æ ¹æ®ä¸Šä¸‹æ–‡æä¾›ç›¸å…³å›ç­”ã€‚
    
    llm:                                           # Agent ä¸“ç”¨ LLM é…ç½®
      provider: "deepseek"
      base_url: "https://api.ppinfra.com/v3/openai"
      api_key: "${DEEPSEEK_API_KEY}"
      model: "deepseek/deepseek-v3-0324"
      temperature: 0.3
      max_tokens: 4096
      timeout: 60
      
    tools:                                         # å¯ç”¨å·¥å…·åˆ—è¡¨
      - name: "file_reader"
        description: "è¯»å–æŒ‡å®šæ–‡ä»¶çš„å†…å®¹"
        parameters:
          type: "object"
          properties:
            file_path:
              type: "string"
              description: "è¦è¯»å–çš„æ–‡ä»¶è·¯å¾„"
          required: ["file_path"]
            
      - name: "file_writer"
        description: "å°†å†…å®¹å†™å…¥æŒ‡å®šæ–‡ä»¶"
        parameters:
          type: "object"
          properties:
            file_path:
              type: "string"
              description: "è¦å†™å…¥çš„æ–‡ä»¶è·¯å¾„"
            content:
              type: "string"
              description: "è¦å†™å…¥çš„å†…å®¹"
            mode:
              type: "string"
              description: "å†™å…¥æ¨¡å¼ï¼šwrite(è¦†ç›–) æˆ– append(è¿½åŠ )"
              enum: ["write", "append"]
              default: "write"
          required: ["file_path", "content"]
          
      - name: "system_info"
        description: "è·å–ç³»ç»Ÿä¿¡æ¯"
        parameters:
          type: "object"
          properties:
            info_type:
              type: "string"
              description: "ä¿¡æ¯ç±»å‹ï¼šplatform, cpu, memory, disk, network"
              enum: ["platform", "cpu", "memory", "disk", "network", "all"]
              default: "all"
          required: []
          
      - name: "calculator"
        description: "æ‰§è¡Œæ•°å­¦è®¡ç®—"
        parameters:
          type: "object"
          properties:
            expression:
              type: "string"
              description: "æ•°å­¦è¡¨è¾¾å¼ï¼Œæ”¯æŒåŸºæœ¬è¿ç®—ã€å‡½æ•°ç­‰"
          required: ["expression"]
          
      - name: "current_time"
        description: "è·å–å½“å‰æ—¶é—´ä¿¡æ¯"
        parameters:
          type: "object"
          properties:
            format:
              type: "string"
              description: "æ—¶é—´æ ¼å¼ï¼šdatetime, timestamp, iso"
              enum: ["datetime", "timestamp", "iso"]
              default: "datetime"
            timezone:
              type: "string"
              description: "æ—¶åŒºï¼Œå¦‚ UTC, Asia/Shanghai"
              default: "local"
          required: []
    
    mcp_servers: []                                # MCP æœåŠ¡å™¨åˆ—è¡¨ (æš‚ä¸ä½¿ç”¨)

# =================================================================
# å·¥ä½œæµé…ç½® (ç¬¦åˆ workflow_schema.base_config)
# =================================================================
workflow:
  name: "æ™ºèƒ½å·¥å…·èŠå¤©æœºå™¨äººå·¥ä½œæµ"
  version: "1.0.0"
  description: "é›†æˆå¤šç§å®ç”¨å·¥å…·çš„èŠå¤©æœºå™¨äººï¼Œæ”¯æŒæ–‡ä»¶æ“ä½œã€ç³»ç»ŸæŸ¥è¯¢ã€æ•°å­¦è®¡ç®—ç­‰"
  author: "DevYK"
  schema_version: "2025.09.10"
  
  settings:
    timeout: 180
    max_retries: 3
    debug_mode: false

  # =================================================================
  # èŠ‚ç‚¹å®šä¹‰ (ç¬¦åˆ node_schema.base_structure)
  # =================================================================
  nodes:
    - name: "start_node"
      type: "start"
      description: "å·¥ä½œæµå¼€å§‹èŠ‚ç‚¹"
      position:
        x: 100
        y: 100
      outputs:
        - name: "user_input"
          type: "string"
          description: "ç”¨æˆ·è¾“å…¥å†…å®¹"

    - name: "chat_agent_with_tools"
      type: "agent"
      description: "æ™ºèƒ½èŠå¤©æœºå™¨äºº Agent (å¸¦å·¥å…·)"
      agent_ref: "chat_agent_with_tools"  # å¼•ç”¨ agents é…ç½®æ®µä¸­çš„ chat_agent_with_tools
      position:
        x: 300
        y: 100
      
      inputs:
        - name: "user_message"
          type: "string"
          required: true
          source: "start_node.user_input"
          description: "ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯"
        - name: "thread_id"
          type: "string"
          required: false
          description: "å¯¹è¯çº¿ç¨‹IDï¼Œç”¨äºè®°å¿†ç®¡ç†"
      
      outputs:
        - name: "response"
          type: "string"
          description: "AIåŠ©æ‰‹çš„å›å¤"
        - name: "tool_results"
          type: "array"
          description: "å·¥å…·æ‰§è¡Œç»“æœåˆ—è¡¨"
        - name: "confidence"
          type: "number"
          description: "å›ç­”çš„ç½®ä¿¡åº¦"

    - name: "end_node"
      type: "end"
      description: "å·¥ä½œæµç»“æŸèŠ‚ç‚¹"
      position:
        x: 500
        y: 100
      inputs:
        - name: "final_response"
          type: "string"
          required: true
          source: "chat_agent_with_tools.response"
          description: "æœ€ç»ˆå›å¤å†…å®¹"
        - name: "tool_results"
          type: "array"
          required: false
          source: "chat_agent_with_tools.tool_results"
          description: "å·¥å…·æ‰§è¡Œç»“æœ"

  # =================================================================
  # è¾¹å®šä¹‰ (ç¬¦åˆ edge_schema.base_structure)
  # =================================================================
  edges:
    - from: "start_node"
      to: "chat_agent_with_tools"
      description: "ä¼ é€’ç”¨æˆ·è¾“å…¥åˆ°æ™ºèƒ½èŠå¤©Agent"
      
    - from: "chat_agent_with_tools"
      to: "end_node"
      description: "è¾“å‡ºæœ€ç»ˆå›å¤å’Œå·¥å…·æ‰§è¡Œç»“æœ"

# =================================================================
# ä½¿ç”¨è¯´æ˜
# =================================================================
usage_notes: |
  æ™ºèƒ½å·¥å…·èŠå¤©æœºå™¨äººæ¨¡ç‰ˆä½¿ç”¨è¯´æ˜ï¼š
  
  1. åŠŸèƒ½ç‰¹ç‚¹ï¼š
     - å®Œå…¨ç¬¦åˆ KaFlow-Py åè®®æ ‡å‡†
     - é›†æˆ 5 ç§å®ç”¨å·¥å…·ï¼šæ–‡ä»¶æ“ä½œã€ç³»ç»Ÿä¿¡æ¯ã€è®¡ç®—å™¨ã€æ—¶é—´æŸ¥è¯¢
     - æ”¯æŒè¿ç»­å¯¹è¯å’Œä¸Šä¸‹æ–‡ç†è§£
     - è‡ªåŠ¨è®°å¿†ç®¡ç†ï¼ˆåŸºäºå…¨å±€memoryé…ç½®ï¼‰
     - ReAct Agent æ¶æ„ï¼Œæ”¯æŒæ¨ç†-è¡ŒåŠ¨-è§‚å¯Ÿå¾ªç¯
     - æ™ºèƒ½å·¥å…·é€‰æ‹©å’Œç»“æœè§£é‡Š
  
  2. æ”¯æŒçš„å·¥å…·ï¼š
     - ğŸ“ file_reader: è¯»å–æ–‡ä»¶å†…å®¹
     - âœï¸ file_writer: å†™å…¥æ–‡ä»¶å†…å®¹
     - ğŸ’» system_info: è·å–ç³»ç»Ÿä¿¡æ¯
     - ğŸ§® calculator: æ•°å­¦è®¡ç®—
     - â° current_time: æ—¶é—´æŸ¥è¯¢
  
  3. ä½¿ç”¨ç¤ºä¾‹ï¼š
     - "å¸®æˆ‘è¯»å– /tmp/test.txt æ–‡ä»¶çš„å†…å®¹"
     - "è®¡ç®— (25 + 75) * 0.8 çš„ç»“æœ"
     - "è·å–å½“å‰ç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µ"
     - "å°†è¿™æ®µæ–‡å­—ä¿å­˜åˆ° notes.txt æ–‡ä»¶ä¸­"
     - "ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ"
  
  4. ç¯å¢ƒå˜é‡ï¼š
     - DEEPSEEK_API_KEY: DeepSeek APIå¯†é’¥
     - æˆ–è€… OPENAI_API_KEY: OpenAI APIå¯†é’¥
  
  5. å¯åŠ¨æ–¹å¼ï¼š
     python main.py --config config/chat_agent_tools.yaml
  
  6. è‡ªå®šä¹‰é…ç½®ï¼š
     - ä¿®æ”¹ system_prompt å®šåˆ¶AIåŠ©æ‰‹çš„è¡Œä¸ºå’Œå·¥å…·ä½¿ç”¨ç­–ç•¥
     - è°ƒæ•´ temperature æ§åˆ¶å›ç­”çš„åˆ›é€ æ€§ï¼ˆå·¥å…·ç‰ˆå»ºè®®è¾ƒä½å€¼ï¼‰
     - ä¿®æ”¹ max_tokens æ§åˆ¶å›ç­”é•¿åº¦
     - æ·»åŠ æˆ–ä¿®æ”¹ tools é…ç½®æ‰©å±•åŠŸèƒ½
     - é…ç½® mcp_servers é›†æˆå¤–éƒ¨å·¥å…·æœåŠ¡ 